(self.webpackChunkwemogy=self.webpackChunkwemogy||[]).push([[194],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||r;return n?o.createElement(h,i(i({ref:t},u),{},{components:n})):o.createElement(h,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1954:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return c},metadata:function(){return u},toc:function(){return p},default:function(){return m}});var o=n(2122),a=n(9756),r=(n(7294),n(3905)),i=n(1395),l=n(8215),s=["components"],c={sidebar_position:4},u={unversionedId:"identity/development",id:"identity/development",isDocsHomePage:!1,title:"Development",description:"Local development",source:"@site/docs-modules/identity/development.md",sourceDirName:"identity",slug:"/identity/development",permalink:"/modules/identity/development",editUrl:"https://github.com/wemogy/documentation/edit/main/docs-modules/identity/development.md",version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Deployment",permalink:"/modules/identity/deployment"},next:{title:"Configuration",permalink:"/modules/identity/configuration"}},p=[{value:"Local development",id:"local-development",children:[{value:"Run a local instance of wemogy Identity",id:"run-a-local-instance-of-wemogy-identity",children:[]},{value:"Run your local app on a different domain than localhost",id:"run-your-local-app-on-a-different-domain-than-localhost",children:[]}]}],d={toc:p};function m(e){var t=e.components,n=(0,a.Z)(e,s);return(0,r.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"local-development"},"Local development"),(0,r.kt)("p",null,"The identity service does not work across domains. This means, if the identity service is currently hosted on ",(0,r.kt)("inlineCode",{parentName:"p"},"myapp.com"),", you won't be able to develop against this instance from ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost"),", as these are two different domains. This is mainly due to the lack of Ory Kratos to work across domains."),(0,r.kt)("p",null,"To use the identity service with local development, you have the following options:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Run a local instance of wemogy Identity"),(0,r.kt)("li",{parentName:"ul"},"Run your local app on a different domain than localhost")),(0,r.kt)("h3",{id:"run-a-local-instance-of-wemogy-identity"},"Run a local instance of wemogy Identity"),(0,r.kt)("p",null,"Coming soon..."),(0,r.kt)("h3",{id:"run-your-local-app-on-a-different-domain-than-localhost"},"Run your local app on a different domain than localhost"),(0,r.kt)("p",null,"For this, we can trick the local web server into assuming that is hosts the local app from the same domain that the identity service runs on instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost"),"."),(0,r.kt)("h4",{id:"override-your-apps-domain-with-localhost"},"Override your app's domain with localhost"),(0,r.kt)("p",null,"First, we need to modify DNS on our development machines in a way, that whenever we navigate to ",(0,r.kt)("inlineCode",{parentName:"p"},"myapp.com"),", it gets resolved to our local machine instead of the actual app hosted on a public IP address in the cloud. The easiest way to achieve this, is to add the following line to your etc/hosts file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="/etc/hosts"',title:'"/etc/hosts"'},"# Use local version of myapp.com for development\n127.0.0.1 myapp.com\n")),(0,r.kt)("p",null,"This ensures, that once the identity service redirects to ",(0,r.kt)("inlineCode",{parentName:"p"},"https://myapp.com/login")," for the login self-service flow for example, your browser will serve from the instance of your app that is running locally."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"While this is active, you won't be able to visit the real ",(0,r.kt)("inlineCode",{parentName:"p"},"https://myapp.com")," anymore from your machine. Make sure to remove or comment the line in ",(0,r.kt)("inlineCode",{parentName:"p"},"etc/hosts")," afterwards."))),(0,r.kt)("h4",{id:"secure-the-local-app-with-ssl-and-serve-it-on-port-443"},"Secure the local app with SSL and serve it on port 443"),(0,r.kt)("p",null,"We also need to make sure, that we are not leaving SSL land when using the local instance of our app. For this, we need to make sure, is uses HTTPS and gets exposed on the same port your production app is running on (usually  443)."),(0,r.kt)("p",null,"Next, we will need a certificate for your domain that can be served by the local web server. Install mkcert on your machine and run the following commands from the root directory of your web app."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# Install mkcert\nmkcert -install\n\n# Create .cert directory if it doesn\'t exist\nmkdir -p .cert\n\n# Generate a certificate for localhost\nmkcert -key-file ./.cert/key.pem -cert-file ./.cert/cert.pem "localhost"\n')),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Don't check-in these certificates into your version control, as they contain confidential information."))),(0,r.kt)("p",null,"Now we have to configure the local web server to use ",(0,r.kt)("inlineCode",{parentName:"p"},"myapp.com")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost")," as its host and use the same port as our production app (usually  443)."),(0,r.kt)(i.Z,{groupId:"framework",defaultValue:"react",values:[{label:"React",value:"react"}],mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"react",mdxType:"TabItem"},(0,r.kt)("p",null,"You can instruct the local web server by creating a file called ",(0,r.kt)("inlineCode",{parentName:"p"},".env.development")," in the root folder of your app. In there, we can instruct the web server to serve on our domain instead of localhost and use the certificates that we have just created."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text",metastring:'title=".env.development"',title:'".env.development"'},"HOST=myapp.com\nPORT=443\nHTTPS=true\nSSL_CRT_FILE=.cert/cert.pem\nSSL_KEY_FILE=.cert/key.pem\n")),(0,r.kt)("p",null,"You can instruct the local web server by creating a file called ",(0,r.kt)("inlineCode",{parentName:"p"},".env.development")," in the root folder of your app. In there, we can instruct the web server to serve on our domain instead of localhost and use the certificates that we have just created."),(0,r.kt)("p",null,"When running ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn start")," now, your browser will open on ",(0,r.kt)("inlineCode",{parentName:"p"},"myapp.com")," but serve the locally running version of your app."))),(0,r.kt)("h4",{id:"cleanup"},"Cleanup"),(0,r.kt)("p",null,"Don't forget to remove the line from the /etc/hosts file after development, to be able to visit the actual myapp.com website again."))}m.isMDXComponent=!0},8215:function(e,t,n){"use strict";var o=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,a=e.className;return o.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},1395:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var o=n(7294),a=n(944),r=n(6010),i="tabItem_1uMI",l="tabItemActive_2DSg";var s=37,c=39;var u=function(e){var t=e.lazy,n=e.block,u=e.defaultValue,p=e.values,d=e.groupId,m=e.className,h=(0,a.Z)(),f=h.tabGroupChoices,v=h.setTabGroupChoices,y=(0,o.useState)(u),k=y[0],g=y[1],w=o.Children.toArray(e.children),b=[];if(null!=d){var N=f[d];null!=N&&N!==k&&p.some((function(e){return e.value===N}))&&g(N)}var C=function(e){var t=e.currentTarget,n=b.indexOf(t),o=p[n].value;g(o),null!=d&&(v(d,o),setTimeout((function(){var e,n,o,a,r,i,s,c;(e=t.getBoundingClientRect(),n=e.top,o=e.left,a=e.bottom,r=e.right,i=window,s=i.innerHeight,c=i.innerWidth,n>=0&&r<=c&&a<=s&&o>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(l),setTimeout((function(){return t.classList.remove(l)}),2e3))}),150))},O=function(e){var t,n;switch(e.keyCode){case c:var o=b.indexOf(e.target)+1;n=b[o]||b[0];break;case s:var a=b.indexOf(e.target)-1;n=b[a]||b[b.length-1]}null==(t=n)||t.focus()};return o.createElement("div",{className:"tabs-container"},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},m)},p.map((function(e){var t=e.value,n=e.label;return o.createElement("li",{role:"tab",tabIndex:k===t?0:-1,"aria-selected":k===t,className:(0,r.Z)("tabs__item",i,{"tabs__item--active":k===t}),key:t,ref:function(e){return b.push(e)},onKeyDown:O,onFocus:C,onClick:C},n)}))),t?(0,o.cloneElement)(w.filter((function(e){return e.props.value===k}))[0],{className:"margin-vert--md"}):o.createElement("div",{className:"margin-vert--md"},w.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==k})}))))}},9443:function(e,t,n){"use strict";var o=(0,n(7294).createContext)(void 0);t.Z=o},944:function(e,t,n){"use strict";var o=n(7294),a=n(9443);t.Z=function(){var e=(0,o.useContext)(a.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},6010:function(e,t,n){"use strict";function o(e){var t,n,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=o(e[t]))&&(a&&(a+=" "),a+=n);else for(t in e)e[t]&&(a&&(a+=" "),a+=t);return a}function a(){for(var e,t,n=0,a="";n<arguments.length;)(e=arguments[n++])&&(t=o(e))&&(a&&(a+=" "),a+=t);return a}n.d(t,{Z:function(){return a}})}}]);